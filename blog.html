<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Live in Oz | Blog & News</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="global.css" />
    <link rel="stylesheet" href="blog.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="blog-page">
    <!-- Navigation bar will be loaded here -->
    <div id="navbar-placeholder"></div>

    <!-- News Ticker -->
    <div class="news-ticker-wrapper">
      <div class="news-ticker-content">
        <span class="news-ticker-text"
          >üî¥ BREAKING: New visa pathways for 2026 |</span
        >
        <span class="news-ticker-text">üéâ Sydney to host Latin Festival |</span>
        <span class="news-ticker-text"
          >üì± Live in Oz app enters testing phase! |</span
        >
        <span class="news-ticker-text"
          >üèñÔ∏è Summer events guide now available |</span
        >
      </div>
    </div>

    <!-- Blog Header -->
    <div class="blog-header-wrapper">
      <h1>üì∞ Blog & News</h1>
      <p>
        Here you'll find the latest information and what's happening in
        Australia üá¶üá∫
      </p>
      <div class="header-neon-line"></div>
    </div>

    <!-- Blog Container -->
    <div class="blog-container" id="blog-container">
      <p style="text-align: center; width: 100%; padding: 40px; color: #ccc">
        Loading posts...
      </p>
    </div>

    <!-- Modal for Blog Post -->
    <!-- Full-Screen Blog Post View -->
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="blog-modal fullscreen" id="blogModal">
      <div class="article-header">
        <button class="back-button" id="modalClose">
          <i class="fas fa-arrow-left"></i> Back to Blog
        </button>
      </div>
      <img id="modalImage" class="article-image" alt="Post image" />
      <div class="article-container">
        <h1 id="modalTitle" class="article-title"></h1>
        <div id="modalBody" class="article-body"></div>
      </div>
    </div>

    <!-- Footer will be loaded here -->
    <div id="footer-placeholder"></div>

    <!-- Load the navigation bar -->
    <script src="nav-loader.js"></script>

    <!-- Load the footer -->
    <script src="footer-loader.js"></script>

    <!-- Load blog posts -->
    <script>
      function escapeHtml(text) {
        const map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        };
        return text.replace(/[&<>"']/g, (m) => map[m]);
      }

      function openModal(post) {
        document.getElementById("modalTitle").textContent = post.title;
        document.getElementById("modalImage").src =
          post.image || "images/1Copy.png";
        document.getElementById("modalImage").alt = post.title;

        let content = post.content;
        const paragraphs = content.split(/(?<=[.!?])\s{2,}|\n\n+/);
        const formattedContent = paragraphs
          .map((p) => p.trim())
          .filter((p) => p.length > 0)
          .map((p) => `<p>${escapeHtml(p)}</p>`)
          .join("");

        document.getElementById("modalBody").innerHTML = formattedContent;

        document.getElementById("blogModal").classList.add("active");
        document.getElementById("modalOverlay").classList.add("active");
        document.body.style.overflow = "hidden";
      }
      function closeModal() {
        document.getElementById("blogModal").classList.remove("active");
        document.getElementById("modalOverlay").classList.remove("active");
        document.body.style.overflow = "auto";
      }

      async function loadBlogPosts() {
        try {
          const response = await fetch("get_blog_posts.php");
          const data = await response.json();
          const container = document.getElementById("blog-container");

          if (data.success && data.posts && data.posts.length > 0) {
            container.innerHTML = "";

            data.posts.forEach((post) => {
              const blogCard = document.createElement("div");
              blogCard.className = "blog-card";

              const image = post.image || "images/1Copy.png";
              const tempDiv = document.createElement("div");
              tempDiv.innerHTML = post.content;
              const textContent =
                tempDiv.textContent || tempDiv.innerText || "";
              const preview =
                textContent.length > 50
                  ? textContent.substring(0, 50) + "..."
                  : textContent;

              blogCard.innerHTML = `
  <div class="card-header">
    <div class="blog-label" data-text="BLOG">BLOG</div>
  </div>
  <div class="card-image-frame">
    <img src="${escapeHtml(image)}" alt="${escapeHtml(
                post.title
              )}" class="card-image" />
  </div>
  <div class="card-content">
    <h3 class="card-title">${escapeHtml(post.title)}</h3>
    <p class="card-preview">${escapeHtml(preview)}</p>
  </div>
`;

              blogCard.addEventListener("click", () => openModal(post));
              container.appendChild(blogCard);
            });
          } else {
            container.innerHTML =
              '<p style="text-align: center; width: 100%; padding: 40px; color: #ccc;">No blog posts available yet.</p>';
          }
        } catch (error) {
          console.error("Error loading blog posts:", error);
          document.getElementById("blog-container").innerHTML =
            '<p style="text-align: center; width: 100%; padding: 40px; color: #ff4444;">Failed to load blog posts. Please try again later.</p>';
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        loadBlogPosts();

        document
          .getElementById("modalClose")
          .addEventListener("click", closeModal);
        document
          .getElementById("modalOverlay")
          .addEventListener("click", closeModal);

        document
          .getElementById("blogModal")
          .addEventListener("click", function (e) {
            e.stopPropagation();
          });
      });
    </script>
  </body>
</html>
